#include "thingProperties.h"
#include "DHT.h"

#define DHT_PIN 5
#define DHT_TYPE DHT11
int relPin = D2;

DHT dht(DHT_PIN, DHT_TYPE);
unsigned long lastReadTime = 0;
void setup() {
  Serial.begin(9600);
  delay(1500); 
  dht.begin();
  initProperties();
  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
  pinMode(LED_BUILTIN, OUTPUT);
  pinMode(relPin, OUTPUT);
}

void loop() {
  ArduinoCloud.update();
  if (ArduinoCloud.connected()) {
   waktu = ArduinoCloud.getLocalTime();
}
  
  float temperature = dht.readTemperature();
  float humidity = dht.readHumidity();
if (millis() - lastReadTime >= 2000) {  
  if (!isnan(temperature) && !isnan(humidity)) {
    Serial.print("Temperature: ");
    Serial.print(temperature);
    Serial.print("Â°C, Humidity: ");
    Serial.print(humidity);
    Serial.println("%");
    
    // Update cloud variables
    suhu = temperature;
    kelembaban = humidity;
    
  } else {
    Serial.println("DHT11 reading error!");
  }
}
  
  if (millis() - lastReadTime >= 1000) {
  if (led==false) {
    digitalWrite(LED_BUILTIN, HIGH);
  } else {
    digitalWrite(LED_BUILTIN, LOW);
  }
  }
  
  if (millis() - lastReadTime >= 1000) {
  if (relay==false) {
    digitalWrite(relPin, HIGH);
  } else {
    digitalWrite(relPin, LOW);
  }
  }
}

void onSuhuChange() {
  // Add your code here to act upon Suhu change
}

void onKelembabanChange() {
  // Add your code here to act upon Kelembaban change
}

void onLedChange() {
  // Add your code here to act upon Led change
}
/*
  Since Waktu is READ_WRITE variable, onWaktuChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onWaktuChange()  {
  // Add your code here to act upon Waktu change
}
/*
  Since Relay is READ_WRITE variable, onRelayChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onRelayChange()  {
  // Add your code here to act upon Relay change
}
